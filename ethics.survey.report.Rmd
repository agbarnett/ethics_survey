---
title: "Report on ethics survey"
author: "Adrian Barnett"
date: "`r format(Sys.time(), '%d %B %Y')`"
output: word_document
---

```{r setup, include=FALSE}
# version using SPSS data
knitr::opts_chunk$set(echo = FALSE, warning=FALSE, message=FALSE, error=FALSE, comment = NA, prompt = FALSE, cache = FALSE, dpi=400)
options(width=1000, scipen = 999) # Wide pages and no scientific numbers
library(ggplot2)
library(tidyr)
library(broom) # for regression tables
library(dplyr)
library(stringr)
library(naniar) # for missing data
library(janitor)
library(pander) # for tables
library(summarytools) # for tables
library(tables) # also for tables
library(R2WinBUGS)
source('99_main_function.R')
source('99_nice_labels.R') # for nice labels on plots
# global options for summary tools
 st_options(plain.ascii = FALSE,       # This is very handy in all Rmd documents
            style = "rmarkdown",        # This too
            round.digits = 0, 
            headings = FALSE, 
            display.labels = FALSE,
            footnote = NA,             # Avoids footnotes which would clutter the results
            subtitle.emphasis = FALSE  # 
 ) 
 
# get the data
load('data/AnalysisReady.RData') # from 0_read_data.R
# chains for WinBUGS
MCMC = 5000
n.thin = 3

# to do
# - remove uncessary rows and columns in ctable
# - change order in legend to match order in figure

# blank starts for summary tables
summary.numbers = summary.numbers.survey = summary.comments = all_responses = NULL
```
# Methods

## Random allocation of surveys

We wanted a high response rate in order to increase generalisability and reduce non-response bias. A survey with all eight scenarios would have been relatively long and may have been poorly completed. Hence we kept our surveys to what we determined as a reasonable length by creating four versions of the survey that each contained four scenarios. Each scenario was represented in two survey versions and the survey version was randomly allocated to each participant, meaning respondents were equally likely to be faced with any of the eight scenarios and the final sample size should be similar across the scenarios.

We used the same four survey versions for the HRECs, however these surveys were not randomly allocated to each individual, but instead the lead contact at each HREC was randomly allocated one of the four survey versions, and they were asked to distribute that survey to all their members. This was primarily for logistical reasons, because we did not have the individual contact names/emails of the committee members, but had to use the lead contact as an intermediary. This creates a potential clustering (or correlation) by survey version if the respondents from particular HRECs are similar. This should not bias the survey, but may invalidate the assumption that observations are independent, which means that are confidence intervals will be too narrow if we ignore the clustering.

Patterns in responses could also occur by survey version if the ordering of the scenarios is important, this is known as "priming". So respondents may answer a scenario differently because there is a priming effect from the previous scenarios. Conversely respondents may answer the first scenario they face differently because they have not been primed.

To test for clustering we used a Bayesian logistic regression model with a fixed effect of scenario (to adjust for the expected differences by scenario) and random effect for the survey version. A wide variation in the random effect would indicate that responses varied by survey version. We also compared the percent of "yes" and "no" answers to the same scenario by version. Each scenario appeared in two survey versions.

We present the results of the Bayesian logistic regression model using means and 95% credible intervals. 

## Other analyses

We give summary statistics on completion dates and the time needed to complete the survey.

We tabulated the results to each scenario. We also tabulated the number of respondents providing additional text for each scenario.

## Software

All analyses were conducted in R version `r version$version.string`. The Bayesian models were fitted in WinBUGS version 1.4.2.

# What surveys were complete?

There were `r nrow(data)` surveys completed in total.

There were 8 different types of surveys with different combinations of the scenarios.
The table below shows the number of responses for each survey type.

```{r, results='asis'}
freq(data$survey, cumul=FALSE, report.nas = FALSE)
```

# Combination of survey and scenario

The table below shows the combinations of surveys and scenarios, where a `1` means that survey included that scenario and a `0` means it did not. Each scenario appears in four versions, and each version has four scenarios.

```{r combinations}
to.table = select(data, 'survey', starts_with('scenario'), -ends_with('_reasons')) %>%
  gather(key='scenario', value='answer', -survey) %>% # wide to long
  mutate(
    answer = ifelse(is.na(answer), '', answer), # replace NAs
    any.answer = answer!='',
    scenario = str_remove_all(string=scenario, pattern = 'scenario_|\\_r[0-9]|[0-9]')) %>% # make text nicer
  group_by(survey, scenario) %>%
  unique() %>%
  summarise(answered = max(any.answer)) %>%
  ungroup()
tabular(Heading('Scenario')*factor(scenario) ~ Heading('')*factor(survey) * Heading('')*answered * Heading('')*sum, data=to.table)
```

* interview = interview with patients, lay persons or carers
* linked = linked data
* n = n-of-1 studies as part of regular, clinical practice
* notrt = no treatment/no behavioural rules imposed
* qa = quality assurance or audit project 
* staff = professional staff providing opinion/views in their area of expertise
* surplus = surplus samples or tissues during routine collection in clinical practice
* survey = survey or questionnaire of patients, lay persons, or care providers

# What date did people start the survey?

```{r start.date}
date.plot = ggplot(data=data, aes(x=start_date))+
  geom_histogram()+
  theme_bw()+
  xlab('Date')+
  ylab('Frequency')
date.plot
# summary stats
date.median = median(data$start_date)
date.q1 = quantile(as.numeric(data$start_date), 0.25)
date.q1 = as.Date(date.q1, origin = '1970-01-01')
date.q3 = quantile(as.numeric(data$start_date), 0.75)
date.q3 = as.Date(date.q3, origin = '1970-01-01')
```

The median time was `r format(date.median, '%d-%b-%Y')` with an inter-quartile range from `r format(date.q1, '%d-%b-%Y')` to `r format(date.q3, '%d-%b-%Y')`.

# How long did people take to complete the survey?

```{r time-taken}
time.plot = ggplot(data=data, aes(x=time_taken))+
  geom_histogram()+
  theme_bw()+
  xlab('Time, minutes')+
  ylab('Frequency')
time.plot
# summary stats
time.median = round(median(data$time_taken))
time.q1 = round(quantile(data$time_taken, 0.25))
time.q3 = round(quantile(data$time_taken, 0.75))
people.hour = sum(data$time_taken > 60) # people taking over an hour
```

The distribution of time taken above shows that most people completed the survey quickly, whereas a few had a long break between starting and finishing.

The median time was `r time.median` minutes, with an interquartile range of `r time.q1` to `r time.q3` minutes. There were `r people.hour` respondents who took over an hour to complete the survey, which is `r round(100*people.hour/nrow(data))`%. The longest time was `r round(max(data$time_taken)/60)` hours.

# Item-missing data

Here we examine the patterns in item-missing data (i.e., skipped questions). We do this by questionnaire for the scenarios, because they varied by questionnaire.

## Missing data in variables common to all surveys

```{r item.missing}
miss = miss_var_summary(select(data, respondent, changed, abandon))
pander(miss, digits=0, style='simple')
```

The overall sample size for this table is `r nrow(data)`.

## Missing scenarios in surveys A and H1

```{r item.missing.AH1}
to.miss = filter(data, survey %in% c('A','H1')) %>%
  select(scenario_interview_r1, scenario_interview_r2, scenario_linked, scenario_qa1, scenario_qa2, scenario_staff1, scenario_staff2, scenario_staff3) %>%
  replace_with_na_all(condition= ~.=='')
miss = miss_var_summary(to.miss)
pander(miss, digits=0, style='simple')
```

The overall sample size for this table is `r nrow(to.miss)`.

## Missing scenarios in surveys B and H2

```{r item.missing.BH2}
to.miss = filter(data, survey %in% c('B','H2')) %>%
  select(scenario_notrt, scenario_staff1, scenario_staff2, scenario_staff3,  scenario_survey1, scenario_survey2, scenario_surplus) %>%
  replace_with_na_all(condition= ~.=='')
miss = miss_var_summary(to.miss)
pander(miss, digits=0, style='simple')
```

The overall sample size for this table is `r nrow(to.miss)`.

## Missing scenarios in surveys C and H3

```{r item.missing.CH3}
to.miss = filter(data, survey %in% c('C','H3')) %>%
  select(scenario_n1, scenario_qa1, scenario_qa2,  scenario_survey1, scenario_survey2, scenario_linked) %>%
  replace_with_na_all(condition= ~.=='')
miss = miss_var_summary(to.miss)
pander(miss, digits=0, style='simple')
```

The overall sample size for this table is `r nrow(to.miss)`.

## Missing scenarios in surveys D and H4

```{r item.missing.DH4}
to.miss = filter(data, survey %in% c('D','H4')) %>%
  select(scenario_notrt, scenario_n1, scenario_interview_r1, scenario_interview_r2, scenario_surplus) %>%
  replace_with_na_all(condition= ~.=='')
miss = miss_var_summary(to.miss)
pander(miss, digits=0, style='simple')
```

The overall sample size for this table is `r nrow(to.miss)`.

# Which of these options best describes you? 

```{r, results='asis'}
freq(data$respondent, cumul=FALSE, report.nas = TRUE)
```

* HREC = Member of an Australian Human Research Ethics Committee (former or current member) 
* Researcher = Human health/medical researcher (former or current) working at an Australian institution (e.g. a university, local health district, research institute, etc.)
* NA = missing.

## Cross-tabulation of respondent by survey

```{r, results='asis'}
ctable(data$survey, data$respondent, prop = "r", useNA = 'no', round.digits = 0, dnn=c('Survey',''), style='rmarkdown')
```

Survey versions A, B, C, D were sent out to researchers, and versions H1, H2, H3, H4 were sent out to HRECs. 

# Question 1: I have changed a project from what I had originally envisioned 

"I have changed a project from what I had originally envisioned to a different project (e.g. to use different methods, study population) because I was concerned about applying for and obtaining ethics approval (e.g., length of time required to obtain approval, complexity, expense, incompatibility with funder timelines, etc.)"

```{r table.q1, results='asis'}
freq(data$changed, cumul=FALSE, report.nas = TRUE)
```

* NA = missing.

### Table excluding not applicables and missing (changed a project)

```{r table.q1.without.na, results='asis'}
no.na = filter(data, changed != "This question does not apply to me") %>%
  mutate(changed = forcats::fct_drop(changed))
freq(no.na$changed, cumul=FALSE, report.nas = FALSE)
```

### Numbers providing optional text (changed a project)

```{r, q1.extra.text, results='asis'}
data = mutate(data, 
              extra = as.numeric(changed_text != ''),
              extra = factor(extra, levels=c(0,1), labels=c("No comment",'With comment')))
freq(data$extra, cumul=FALSE, report.nas = FALSE)
```

### Cross-tabulation by respondents (changed a project)

```{r, results='asis'}
ctable(no.na$respondent, no.na$changed, prop = "r", useNA = 'no', round.digits = 0, dnn=c('Respondent',''), style='rmarkdown')
```


# Question 2: I abandoned a project I had intended to conduct 

"I abandoned a project I had intended to conduct because I was concerned about applying for and obtaining ethics approval (e.g., length of time required to obtain approval, complexity, expense, incompatibility with funder timelines, etc.)"

```{r table.q2, results='asis'}
freq(data$abandon, cumul=FALSE, report.nas = TRUE)
```

NA is missing.

### Table excluding not applicables and missing (abandoned a project)

```{r table.q2.without.na, results='asis'}
no.na = filter(data, abandon != "This question does not apply to me") %>%
  mutate(abandon = forcats::fct_drop(abandon))
freq(no.na$abandon, cumul=FALSE, report.nas = FALSE)
```

### Numbers providing optional text (abandoned a project)

```{r, q2.extra.text, results='asis'}
data = mutate(data, 
              extra = as.numeric(abandon_text != ''),
              extra = factor(extra, levels=c(0,1), labels=c("No comment",'With comment')))
freq(data$extra, cumul=FALSE, report.nas = FALSE)
```

### Cross-tabulation by respondents (abandoned a project)

```{r, results='asis'}
ctable(no.na$respondent, no.na$abandon, prop = "r", useNA = 'no', round.digits = 0, dnn=c('Respondent',''), style='rmarkdown')
```

The percent abandoning a project was highest in HREC respondents.

# Scenario: Linked data sets ('big data' population health research)

"A study involving the use of linked, de-identified administrative data sets (e.g. registries, administrative data, electronic health records). For example, consider a study of the cardiovascular safety of non-steroidal anti-inflammatory drugs (NSAIDs e.g. Naprosyn, Nurofen). This study involved a de-identified (no names, no full date of birth, no postcode) data set of people over 75 years of age who used, or did not use, NSAIDs. The prescription records were linked to hospitalisation diagnoses and deaths (with causes) and the rates of fatal and non-fatal heart attacks were compared in users and non-users of the drugs. The data centre holding the original data set has assessed the proposed project and analyses for privacy impact, feasibility of the study with the available data, and adequacy of data set creation and analysis plans, and has approved the project. The de-identified linked data were held in a secure facility. Individual level data could not be seen on screen. Data were located in a secure environment that allowed analysis but did NOT allow download of the data and did NOT allow download of the analyses. The analyses were checked by data-centre staff for privacy risk before release to the researchers."

```{r table.scenario.linked, results='asis'}
tables = table.scenario(indata=data, in_scenario_text = 'scenario_linked') # run the main function
# concatenate for later summaries
summary.numbers = bind_rows(summary.numbers, tables$numbers)
summary.numbers.survey = bind_rows(summary.numbers.survey, tables$numbers.survey)
all_responses = bind_rows(all_responses, tables$responses)
# show the table
tables$freq.table
```

### Cross-tabulation by survey version (linked data)

```{r, results='asis'}
tables$ctab # cross-tabulation by survey
```

### Numbers providing optional text (Scenario: Linked data sets)

```{r, linked.extra.text, results='asis'}
optional = table.reasons(indata=data, in_scenario_text = 'scenario_linked', in_scenario_reason = 'scenario_linked_reasons') 
# concatenate
summary.comments = bind_rows(summary.comments, optional$numbers)
# show the table
optional$freq.table
```

# Scenario: Interview with patients, lay persons or carers (non-professional)

"An interview (one-on-one or in a group, such as a focus group) of patients, lay persons, or care providers. Consent has been obtained from participants by the research team. The interview does NOT include questions about highly sensitive areas (e.g. suicide, mental illness, HIV status, recreational drug use), AND meets one of the following criteria:

## Criteria 1 (interviews)

"Identity of interviewed person(s) is known to the research team but not to the interviewer, and identity cannot be readily identified by the interviewer."

```{r table.scenario.interview.r1, results='asis'}
tables = table.scenario(indata=data, in_scenario_text = 'scenario_interview_r1') # run the main function
# concatenate
summary.numbers = bind_rows(summary.numbers, tables$numbers)
summary.numbers.survey = bind_rows(summary.numbers.survey, tables$numbers.survey)
all_responses = bind_rows(all_responses, tables$responses)
# show the table
tables$freq.table
```

### Cross-tabulation by survey version (interviews)

```{r, results='asis'}
tables$ctab # cross-tabulation by survey
```

There is a large difference in responses for versions A and D, and this difference occurs for both HRECs and researchers. 

## Criteria 2 (interviews)

"Identity of interviewed person(s) is known to the research team including the interviewer, but is not disclosed to anyone else."

```{r table.scenario.interview.r2, results='asis'}
tables = table.scenario(indata=data, in_scenario_text = 'scenario_interview_r2') # run the main function
# concatenate
summary.numbers = bind_rows(summary.numbers, tables$numbers)
summary.numbers.survey = bind_rows(summary.numbers.survey, tables$numbers.survey)
all_responses = bind_rows(all_responses, tables$responses)
# show the table
tables$freq.table
```

### Cross-tabulation by survey version (interviews)

```{r, results='asis'}
tables$ctab
```

### Numbers providing optional text (interviews)

```{r, interviews.extra.text, results='asis'}
optional = table.reasons(indata=data, in_scenario_text = 'scenario_interview_r1', in_scenario_reason = 'scenario_interview_reasons') # Note, okay that it`s _r1 here not _r2
# concatenate
summary.comments = bind_rows(summary.comments, optional$numbers)
# show the table
optional$freq.table
```

# Scenario: Quality assurance or audit project

"To promote good clinical care, audit projects are done to produce information about whether care standards comply with national standards and practice guidelines. Those conducting the audit will report the findings to inform planned improvements locally, and they may also disseminate their findings through publication in a journal."

## Example A (quality assurance) 

"An audit and feedback project to reduce inappropriate prescribing, e.g., a chart audit of sedative-hypnotics prescribed to older hospitalised patients."

```{r table.scenario.qa1, results='asis'}
tables = table.scenario(indata=data, in_scenario_text = 'scenario_qa1') # run the main function
# concatenate
summary.numbers = bind_rows(summary.numbers, tables$numbers)
summary.numbers.survey = bind_rows(summary.numbers.survey, tables$numbers.survey)
all_responses = bind_rows(all_responses, tables$responses)
# show the table
tables$freq.table
```

### Cross-tabulation by survey version

```{r, results='asis'}
tables$ctab
```

## Example B (quality assurance) 

"Evaluation, pre- and post-simulation training, of door-to-needle time (time between arrival to emergency dept. and administration of treatment) of patients with acute stroke, with the aim of improving treatment initiation."

```{r table.scenario.qa2, results='asis'}
tables = table.scenario(indata=data, in_scenario_text = 'scenario_qa2') # run the main function
# concatenate
summary.numbers = bind_rows(summary.numbers, tables$numbers)
summary.numbers.survey = bind_rows(summary.numbers.survey, tables$numbers.survey)
all_responses = bind_rows(all_responses, tables$responses)
# show the table
tables$freq.table
```

### Cross-tabulation by survey version

```{r, results='asis'}
tables$ctab
```

## Example C (quality assurance) 

"Use of direct observation to examine nursing care for sick newborns, to identify missed elements of care, such as phototherapy sessions."

```{r table.scenario.qa3, results='asis'}
tables = table.scenario(indata=data, in_scenario_text = 'scenario_qa3') # run the main function
# concatenate
summary.numbers = bind_rows(summary.numbers, tables$numbers)
summary.numbers.survey = bind_rows(summary.numbers.survey, tables$numbers.survey)
all_responses = bind_rows(all_responses, tables$responses)
# show the table
tables$freq.table
```

### Cross-tabulation by survey version

```{r, results='asis'}
tables$ctab
```

### Numbers providing optional text (quality assurance)

```{r, qa.extra.text, results='asis'}
optional = table.reasons(indata=data, in_scenario_text = 'scenario_qa1', in_scenario_reason = 'scenario_qa_reasons') 
# concatenate
summary.comments = bind_rows(summary.comments, optional$numbers)
# show the table
optional$freq.table
```

# Scenario: Professional staff providing opinion/views in their area of expertise

"Professional staff (e.g. hospital staff, researchers) are asked 'as volunteers' about their views on a topic in their areas of expertise or professional practice, through either a face to face interview or written/online survey."

## Example A (professional staff)

"A survey of general practitioners to prioritise a list of systematic review topics for a Cochrane group."

```{r table.scenario.staff1, results='asis'}
tables = table.scenario(indata=data, in_scenario_text = 'scenario_staff1') # run the main function
# concatenate
summary.numbers = bind_rows(summary.numbers, tables$numbers)
summary.numbers.survey = bind_rows(summary.numbers.survey, tables$numbers.survey)
all_responses = bind_rows(all_responses, tables$responses)
# show the table
tables$freq.table
```

### Cross-tabulation by survey version

```{r, results='asis'}
tables$ctab
```


## Example B (professional staff)

"A survey asking systematic reviewers to report on the strengths and weaknesses of systematic review software."

```{r table.scenario.staff2, results='asis'}
tables = table.scenario(indata=data, in_scenario_text = 'scenario_staff2') # run the main function
# concatenate
summary.numbers = bind_rows(summary.numbers, tables$numbers)
summary.numbers.survey = bind_rows(summary.numbers.survey, tables$numbers.survey)
all_responses = bind_rows(all_responses, tables$responses)
# show the table
tables$freq.table
```

### Cross-tabulation by survey version (professional staff)

```{r, results='asis'}
tables$ctab
```

## Example C (professional staff) 

"An interview of all physiotherapists in a hospital on barriers and facilitators they have experienced in implementing a specific therapy for patients."

```{r table.scenario.staff3, results='asis'}
tables = table.scenario(indata=data, in_scenario_text = 'scenario_staff3') # run the main function
# concatenate
summary.numbers = bind_rows(summary.numbers, tables$numbers)
summary.numbers.survey = bind_rows(summary.numbers.survey, tables$numbers.survey)
all_responses = bind_rows(all_responses, tables$responses)
# show the table
tables$freq.table
```

### Cross-tabulation by survey version (professional staff)

```{r, results='asis'}
tables$ctab
```

### Numbers providing optional text (professional staff)

```{r, staff.extra.text, results='asis'}
optional = table.reasons(indata=data, in_scenario_text = 'scenario_staff1', in_scenario_reason = 'scenario_staff_reasons') 
# concatenate
summary.comments = bind_rows(summary.comments, optional$numbers)
# show the table
optional$freq.table
```

# Scenario: No treatment/no behavioural rules imposed

"Study of any design (cohort, randomised control trial, other designs) that does not require participants to receive any treatment that is not already in routine use, and does not require participants to follow any behavioural rules that are not already applied in routine care. For example, consider a study involving hospitalised patients. The hospital already uses two types of mattress, with some beds using mattress A, and other beds using mattress B. There is uncertainty about whether one of the mattresses is better at preventing bed sores than the other. To address this uncertainty, patients will be randomly allocated either to mattress A or to mattress B, and the incidence of bed sores will be compared in the two groups."

```{r table.scenario.notrt, results='asis'}
tables = table.scenario(indata=data, in_scenario_text = 'scenario_notrt') # run the main function
# concatenate
summary.numbers = bind_rows(summary.numbers, tables$numbers)
summary.numbers.survey = bind_rows(summary.numbers.survey, tables$numbers.survey)
all_responses = bind_rows(all_responses, tables$responses)
# show the table
tables$freq.table
```

### Cross-tabulation by survey version (no treatment)

```{r, results='asis'}
tables$ctab
```


### Numbers providing optional text (no treatment)

```{r, notrt.extra.text, results='asis'}
optional = table.reasons(indata=data, in_scenario_text = 'scenario_notrt', in_scenario_reason = 'scenario_notrt_reasons') 
# concatenate
summary.comments = bind_rows(summary.comments, optional$numbers)
# show the table
optional$freq.table
```

# Scenario: Survey/questionnaire of patients, lay persons or carer (non-professional)

"A survey or questionnaire of patients, lay persons, or care providers, which does NOT include questions about highly sensitive areas (e.g. suicide, mental illness, HIV status, recreational drug use), AND meets one the following criteria:"

## Criteria 1 (surveys)

"Identity of respondents cannot be readily identified (i.e. the survey or questionnaire is anonymous)."

```{r table.scenario.survey1, results='asis'}
tables = table.scenario(indata=data, in_scenario_text = 'scenario_survey1') # run the main function
# concatenate
summary.numbers = bind_rows(summary.numbers, tables$numbers)
summary.numbers.survey = bind_rows(summary.numbers.survey, tables$numbers.survey)
all_responses = bind_rows(all_responses, tables$responses)
# show the table
tables$freq.table
```

### Cross-tabulation by survey version (surveys)

```{r, results='asis'}
tables$ctab
```

## Criteria 2 (surveys)

"Identity of respondents is known only to the research team and is not disclosed outside of the research team."

```{r table.scenario.survey2, results='asis'}
tables = table.scenario(indata=data, in_scenario_text = 'scenario_survey2') # run the main function
# concatenate
summary.numbers = bind_rows(summary.numbers, tables$numbers)
summary.numbers.survey = bind_rows(summary.numbers.survey, tables$numbers.survey)
all_responses = bind_rows(all_responses, tables$responses)
# show the table
tables$freq.table
```

### Cross-tabulation by survey version (surveys)

```{r, results='asis'}
tables$ctab
```

### Numbers providing optional text (surveys)

```{r, surveys.extra.text, results='asis'}
optional = table.reasons(indata=data, in_scenario_text = 'scenario_survey1', in_scenario_reason = 'scenario_survey_reasons') 
# concatenate
summary.comments = bind_rows(summary.comments, optional$numbers)
# show the table
optional$freq.table
```

# Scenario: N-of-1 studies as part of regular clinical practice

"A patient recently started on a statin has complained to his general practitioner (GP) about muscle pains and fatigue, and says that he is considering stopping the drug. The GP wants to be confident that the statins are likely to be the cause of the patient’s symptoms, so – with the patient’s consent – the patient is allocated to 2 weeks on a placebo and 2 weeks on a statin, but with the ordering of the drug and placebo concealed. Altogether, 20 of the GP’s patients taking a statin and complaining about the unpleasant symptoms, consent to using this approach before deciding whether to stop the statins. The patients keep records of their symptoms throughout the duration of the administration of the drug or placebo.  The GP finds that most patients experience unpleasant symptoms whilst taking statins, but the symptoms disappear whilst taking placebo. The GP wishes to use these findings to help her patients and share them more widely through publication."

```{r table.scenario.nof1, results='asis'}
tables = table.scenario(indata=data, in_scenario_text = 'scenario_n1') # run the main function
# concatenate
summary.numbers = bind_rows(summary.numbers, tables$numbers)
summary.numbers.survey = bind_rows(summary.numbers.survey, tables$numbers.survey)
all_responses = bind_rows(all_responses, tables$responses)
# show the table
tables$freq.table
```

### Cross-tabulation by survey version

```{r, results='asis'}
tables$ctab
```

### Numbers providing optional text (n-of-1)

```{r, n1.extra.text, results='asis'}
optional = table.reasons(indata=data, in_scenario_text = 'scenario_n1', in_scenario_reason = 'scenario_n1_reasons') 
# concatenate
summary.comments = bind_rows(summary.comments, optional$numbers)
# show the table
optional$freq.table
```

# Scenario: Surplus samples or tissues during routine collection in clinical practice

"Research may use surplus (extra) tissue or samples obtained from people during routine medical procedures. For example, extra blood could be drawn at the time of medically required or routine sampling. Tissue not required for diagnosis or testing could be collected during routine clinical procedures requiring tissue sampling."

```{r table.scenario.surplus, results='asis'}
tables = table.scenario(indata=data, in_scenario_text = 'scenario_surplus') # run the main function
# concatenate
summary.numbers = bind_rows(summary.numbers, tables$numbers)
summary.numbers.survey = bind_rows(summary.numbers.survey, tables$numbers.survey)
all_responses = bind_rows(all_responses, tables$responses)
# show the table
tables$freq.table
```

### Cross-tabulation by survey version

```{r, results='asis'}
tables$ctab
```

### Numbers providing optional text (surplus)

```{r, surplus.extra.text, results='asis'}
optional = table.reasons(indata=data, in_scenario_text = 'scenario_surplus', in_scenario_reason = 'scenario_surplus_reasons') 
# concatenate
summary.comments = bind_rows(summary.comments, optional$numbers)
# show the table
optional$freq.table
```

# Other research types/scenarios that could be exempted

"OPTIONAL: Do you think there are other type(s) of human health/medical research that could ALSO be considered for exemption from a requirement to undergo ethics review in Australia?" 

```{r, other.extra.text, results='asis'}
data = mutate(data,
         extra = as.numeric(open_ended != ''),
         extra = factor(extra, levels=c(0,1), labels=c("No comment",'With comment')))
freq(data$extra, cumul=FALSE, report.nas = FALSE)
# summary for later graph/table
numbers = group_by(data, extra) %>%
  summarise(count = n()) %>%
  mutate(scenario='other types') 
summary.comments = bind_rows(summary.comments, numbers)
```

# Summary plot of scenario results

The rows are ordered by the percent saying that the scenario should require an ethics review.

```{r summary.plot, fig.width=11, fig.height=7}
colours = c("cornflowerblue", "darkgoldenrod2", "gray83")
summary.percents = group_by(summary.numbers, scenario) %>%
  mutate(
    #
    scenario_long = case_when(
      scenario == 'surplus' ~ 'Surplus samples/tissues scenario',
scenario == 'n1' ~ 'N of 1 studies in clinical practice',
scenario == 'interview_r2' ~ ' Interview with patients, example B',
scenario == 'survey2' ~ 'Survey/questionnaire of patients, example B',
scenario == 'interview_r1' ~ 'Interview with patients, example A', 
scenario == 'staff3' ~ 'Professional staff providing opinion, example C',
scenario == 'notrt' ~ 'No treatment/no behavioural rules',
scenario == 'qa3' ~ 'Quality assurance or audit, example C',
scenario == 'survey1' ~ 'Survey/questionnaire of patients, example A',
scenario == 'linked' ~ 'Linked data sets',
scenario == 'qa2' ~ 'Quality assurance or audit, example B',
scenario == 'qa1' ~ 'Quality assurance or audit, example A',
scenario == 'staff1' ~ 'Professional staff providing opinion, example A',
scenario == 'staff2' ~ 'Professional staff providing opinion, example B'),
    #
     answer = ifelse(is.na(answer), 'missing', answer),
     answern = case_when(answer=="Should NOT require ethics review"~3, # use this numbering to get order in plot
                          answer=="SHOULD require ethics review"~2,
                          answer=="missing"~1),
     N = sum(count),
     percent = 100*count/N) %>%
  ungroup()
# order by percent should
percent.should = filter(summary.percents, answer=='SHOULD require ethics review') %>%
  select(scenario, percent) %>%
  rename('should.percent' = 'percent')
to.plot = left_join(summary.percents, percent.should, 'scenario') %>%
  arrange(should.percent) %>% # order rows by percent should
  mutate(yaxis = rank(should.percent),
         yaxis = as.numeric(as.factor(yaxis)))
to.plot = mutate(to.plot,
         yaxis = factor(yaxis, levels=1:14, labels=unique(to.plot$scenario_long)))
splot = ggplot(data=to.plot, aes(x=yaxis, y=percent, fill=factor(answern)))+
  geom_bar(stat ='identity')+
  scale_y_continuous(expand = c(0.01, 0.01))+ # reduce gaps at ends of bars
  xlab('')+
  ylab('Percent')+
  scale_fill_manual(NULL, values=colours, breaks=c(3,2,1), labels=c('Should NOT','Should','Missing'))+
  theme_bw()+
  coord_flip()+
  theme(legend.position = 'top', 
        plot.margin = margin(t=0, r=20, b=0, l=0), # expand right-hand axis slightly
        text=element_text(size=18))
splot
jpeg('figures/bar_plot.jpg', width=8.5, height=5, units='in', res=500, quality=100)
print(splot)
invisible(dev.off())
```

### Version without missing

```{r, fig.width=11, fig.height=7}
colours = c("cornflowerblue", "darkgoldenrod2")
summary.percents = 
  filter(summary.numbers, !is.na(answer)) %>%
  group_by(scenario) %>%
  mutate(
    #
    scenario_long = case_when(
      scenario == 'surplus' ~ 'Surplus samples/tissues scenario',
scenario == 'n1' ~ 'N of 1 studies in clinical practice',
scenario == 'interview_r2' ~ ' Interview with patients, example B',
scenario == 'survey2' ~ 'Survey/questionnaire of patients, example B',
scenario == 'interview_r1' ~ 'Interview with patients, example A', 
scenario == 'staff3' ~ 'Professional staff providing opinion, example C',
scenario == 'notrt' ~ 'No treatment/no behavioural rules',
scenario == 'qa3' ~ 'Quality assurance or audit, example C',
scenario == 'survey1' ~ 'Survey/questionnaire of patients, example A',
scenario == 'linked' ~ 'Linked data sets',
scenario == 'qa2' ~ 'Quality assurance or audit, example B',
scenario == 'qa1' ~ 'Quality assurance or audit, example A',
scenario == 'staff1' ~ 'Professional staff providing opinion, example A',
scenario == 'staff2' ~ 'Professional staff providing opinion, example B'),
    #
     answer = ifelse(is.na(answer), 'missing', answer),
     answern = case_when(answer=="Should NOT require ethics review"~2, # use this numbering to get order in plot
                          answer=="SHOULD require ethics review"~1),
     N = sum(count),
     percent = 100*count/N) %>%
  ungroup()
# order by percent should
percent.should = filter(summary.percents, answer=='SHOULD require ethics review') %>%
  select(scenario, percent) %>%
  rename('should.percent' = 'percent')
to.plot = left_join(summary.percents, percent.should, 'scenario') %>%
  arrange(should.percent) %>% # order rows by percent should
  mutate(yaxis = rank(should.percent),
         yaxis = as.numeric(as.factor(yaxis)))
to.plot = mutate(to.plot,
         yaxis = factor(yaxis, levels=1:14, labels=unique(to.plot$scenario_long)))
splot = ggplot(data=to.plot, aes(x=yaxis, y=percent, fill=factor(answern)))+
  geom_bar(stat ='identity')+
  scale_y_continuous(expand = c(0.01, 0.01))+ # reduce gaps at ends of bars
  xlab('')+
  ylab('Percent')+
  scale_fill_manual(NULL, values=colours, breaks=c(2,1), labels=c('Should NOT','Should'))+
  theme_bw()+
  coord_flip()+
  theme(legend.position = 'top', 
        plot.margin = margin(t=0, r=20, b=0, l=0), # expand right-hand axis slightly
        text=element_text(size=18))
splot
jpeg('figures/bar_plot_no_missing.jpg', width=8.5, height=5, units='in', res=500, quality=100)
print(splot)
invisible(dev.off())
```

# Summary table of the number of comments

The table below shows the number and percent of comments per scenario. The rows are ordered from the most to least commented.

```{r summary.table}
to.table = tidyr::spread(summary.comments, extra, count) %>%
  mutate(total = `No comment` + `With comment`,
         perc1 = round(100*`No comment`/total), 
         perc2 = 100 - perc1, 
         `No comment` = paste(`No comment`, ' (', perc1, ')', sep=''),
         `With comment` = paste(`With comment`, ' (', perc2, ')', sep='')
         ) %>%
  arrange(-perc2) %>% # rows by most comments
  select(-perc1, -perc2) 
pander(to.table, style='simple')
```

# Do the scenario responses vary by group (researcher, HREC or both)

Each respondent was asked about four scenarios and whether they did or did not require ethics review. Here we examine if there was a difference between the three respondent groups.

## Boxplot

```{r numbers.should}
# switch to long and count numbers per respondent
counts = dplyr::select(data, 'id', 'respondent', starts_with('scenario'), -ends_with('reasons')) %>%
  gather(key='scenario', value='response', -id, -respondent) %>%
  filter(response !='', !is.na(respondent)) %>%
  mutate(answer = str_detect(string=response, pattern='SHOULD require ethics')) %>%
  group_by(id, respondent) %>%
  summarise(N=n(), not = sum(answer), p=not/N) %>%
  ungroup()
box = ggplot(data=counts, aes(x=factor(respondent), y=p)) +
  geom_boxplot()+
  xlab('')+
  ylab('Proportion answered as requiring ethics review')+
  theme_bw()
box
```

# Bayesian logistic regression model

We used a Bayesian logistic regression model to estimate the probability of respondents answering that ethics is required. The model examined the effects of the:

* 14 scenarios
* 4 survey versions
* 3 respondent types (HREC/Researcher/Both)

We also adjusted for repeated data from the same respondent using a random intercept.

We tried a more complex regression model where the probability of response for each scenario varied by respondent type. However, the deviance information criterion for this model was substantially greater (indicating a worse fit), hence we present the simpler model.

```{r create.bugs.model, include=FALSE}
### This model was better than one below
# create external text file with bugs model
bugs.file = 'logistic.bugs.individual.combined.txt'
bugs = file(bugs.file, 'w')
cat('model{
    for (i in 1:N){
       answer[i] ~ dbern(p[i])
       logit(p[i]) <- intercept + gamma[1]*resp1[i] + gamma[2]*resp2[i] + zeta.c[id[i]] + alpha.c[scenario[i]] + beta.c[version[i]]
    }
    intercept ~ dnorm(0, 0.001)
    gamma[1] ~ dnorm(0, 0.001)
    gamma[2] ~ dnorm(0, 0.001)
		for (j in 1:K){
		  zeta[j] ~ dnorm(0, tau.zeta)
		  zeta.c[j] <- zeta[j] - mu.zeta
		}
		for (j in 1:M){
		  beta[j] ~ dnorm(0, tau.beta)
		  beta.c[j] <- beta[j] - mu.beta
		  logit(p.version[j]) <- intercept + beta.c[j]
		}
		for (j in 1:S){ # loop for scenarios
		  alpha[j] ~ dnorm(0, tau.alpha)
		  alpha.c[j] <- alpha[j] - mu.alpha
		  logit(p.scenario[j,1]) <- intercept + alpha.c[j] # predictions, # HREC
		  logit(p.scenario[j,2]) <- intercept + alpha.c[j] + gamma[1] # Both
		  logit(p.scenario[j,3]) <- intercept + alpha.c[j] + gamma[2] # Researcher
		}
		tau.alpha ~ dgamma(1,1)
		tau.beta ~ dgamma(1,1)
		tau.zeta ~ dgamma(1,1)
		mu.beta  <- mean(beta[1:M])
		mu.zeta  <- mean(zeta[1:M])
		mu.alpha  <- mean(alpha[1:S])
}\n', file=bugs)
close(bugs)
```


```{r, run.bugs.model}
# prepare data for bugs
for.logistic = filter(all_responses, !is.na(respondent)) %>% # exclude 9 with missing respondent data
  mutate(answern = as.numeric(answer=='SHOULD require ethics review'),
         resp2 = as.numeric(respondent == 'Researcher'),
         resp1 = as.numeric(respondent == 'Both'), # reference = HREC
         surveyn = case_when(survey %in% c('A','H1') ~ 1,
                             survey %in% c('B','H2') ~ 2,
                             survey %in% c('C','H3') ~ 3,
                             survey %in% c('D','H4') ~ 4), # convert to numbers for winbugs
        scenarion = as.numeric(as.factor(scenario)),
        id = as.numeric(as.factor(id))) # 
scenario.labels = sort(unique(for.logistic$scenario)) # nicer text-based labels (used below)

# set up data for WinBUGS  
N = nrow(for.logistic)
K = length(unique(for.logistic$id))
M = 4 # number of survey versions
S = length(unique(for.logistic$scenario))
bdata = with(for.logistic,
             list(N = N, 
             K = K,
             M = M,
             S = S,
             id = id,
             resp1 = resp1,
             resp2 = resp2,
             scenario = scenarion,
             version = surveyn,
             answer = answern))
inits = list(tau.beta=1, tau.zeta=1, tau.alpha=1, zeta=rep(0,K), alpha=rep(0,S), beta=rep(0,M), gamma=c(0,0), intercept=0)
inits = rep(list(inits), 2) # for two chains

# run BUGS
parms = c('alpha.c','beta.c','tau.zeta','tau.beta','tau.alpha','gamma','intercept','p.version','p.scenario')
if(length(dir('results', pattern='combined')) > 0){ # load existing data if results
  load('results/bugs_combined.RData')
}
if(length(dir('results', pattern='combined')) == 0){ # run if no results
  bugs.results = bugs(data=bdata, inits=inits, parameters=parms, model.file=bugs.file,
                       n.chains=2, n.thin=n.thin, n.iter=MCMC*n.thin*2, debug=TRUE,
                       bugs.directory="c:/Program Files/WinBUGS14", DIC=TRUE)
  res.combined = bugs.results$summary
  save(bugs.results, res.combined, file='results/bugs_combined.RData')
}
# use chains to calculate probability of difference in survey versions
index = grep('beta\\.', dimnames(bugs.results$sims.array)[[3]]) # find the survey version estimates
chains1 = as.matrix(bugs.results$sims.array[1:MCMC, 1, index])
chains2 = as.matrix(bugs.results$sims.array[1:MCMC, 2, index])
chains = data.frame(rbind(chains1, chains2)) %>%
  mutate(diff = `beta.c.1.` - `beta.c.4.`) 
p.value.version  = sum(chains$diff>0) / ((MCMC*2) + 1) # one-sided
# check variances
tau = data.frame(res.combined[grep('tau', rownames(res.combined)), c(1,3,7)])
tau$var = rownames(tau)
tau = mutate(tau, sigma = 1/sqrt(mean)) %>%
  mutate(source = case_when(
    var == 'tau.alpha' ~ 'scenario',
    var == 'tau.beta' ~ 'version',
    var == 'tau.zeta' ~ 'individual',
  )) %>%
  select(source, sigma)
```

##### Plot of estimated probabilties and 95% CIs for answering that the scenario should require ethics

```{r plot.lmodel.fixed, fig.height=11, fig.width=10}
scenario.combined = data.frame(res.combined[grep('p.scenario', rownames(res.combined)), c(1,3,7)])
names(scenario.combined) = c('mean','lower','upper')
scenario.combined = mutate(scenario.combined,
            var = rownames(scenario.combined),
            var = str_remove_all(var, pattern='[a-z]|\\.|\\[|\\]'),
            scenarion = as.numeric(str_split_fixed(var, pattern=',', n=2)[,1]), # extract scenario and response numbers
            respn = as.numeric(str_split_fixed(var, pattern=',', n=2)[,2])) %>%
  select(-var)
# get groups means
gmeans = group_by(scenario.combined, scenarion) %>%
  summarise(gmean = mean(mean)) %>%
  ungroup() %>%
  arrange(gmean) %>%
  mutate(xaxis= 1:n()) %>%
  left_join(scenario.combined, by='scenarion') %>%
  mutate(xaxis = ifelse(respn==1, xaxis+0.3, xaxis), # jitter
         xaxis = ifelse(respn==3, xaxis-0.3, xaxis)) 
# get labels
gmeans.labels = select(gmeans, scenarion, xaxis) %>%
  filter(xaxis %% 1 == 0) %>% # integers only
  mutate(scenario = scenario.labels[scenarion ],
    scenario_long = case_when( # add longer labels
      scenario == 'surplus' ~ 'Surplus samples/tissues scenario',
scenario == 'n1' ~ 'N of 1 studies in clinical practice',
scenario == 'interview_r2' ~ ' Interview with patients, example B',
scenario == 'survey2' ~ 'Survey/questionnaire of patients, example B',
scenario == 'interview_r1' ~ 'Interview with patients, example A', 
scenario == 'staff3' ~ 'Professional staff providing opinion, example C',
scenario == 'notrt' ~ 'No treatment/no behavioural rules',
scenario == 'qa3' ~ 'Quality assurance or audit, example C',
scenario == 'survey1' ~ 'Survey/questionnaire of patients, example A',
scenario == 'linked' ~ 'Linked data sets',
scenario == 'qa2' ~ 'Quality assurance or audit, example B',
scenario == 'qa1' ~ 'Quality assurance or audit, example A',
scenario == 'staff1' ~ 'Professional staff providing opinion, example A',
scenario == 'staff2' ~ 'Professional staff providing opinion, example B'))
x.labels = as.character(gmeans.labels$scenario_long)
# plot estimated means and CIs
colours = c("#E69F00", "#56B4E9", "#009E73")
fplot = ggplot(data=gmeans, aes(x=xaxis, y=mean, ymin=lower, ymax=upper, col=factor(respn)))+
  geom_vline(lty=2, col='grey', xintercept=seq(0.5, 14.5, 1))+
  geom_point(size=5)+
  scale_color_manual(NULL, values=colours, labels=c('HREC','Both',"Researcher"))+
  geom_errorbar(width=0, lwd=1.1)+
  scale_x_continuous(breaks=1:14, labels=x.labels, limits=c(0.5, 14.5), expand = c(0,0))+ # limits/expand to reduce white space
  theme_bw()+
  theme(panel.grid.minor = element_blank(), 
        panel.grid.major.y = element_blank(),
        legend.position = c(0,1), # legend to appear in top-left ...
        legend.justification = c(0,1), # ...
        legend.background = element_rect(fill="transparent"),
        plot.margin = unit(c(0,4,0,0), "mm"), #top, right, bottom, left.
        axis.title.x = element_text(hjust=1), # making sure long legend appears
        text = element_text(size=22))+
  xlab('')+
  ylab('Probability of answering that ethics is required')+
  coord_flip()
fplot
jpeg('figures/probability_scenarios_three.jpg', width=10, height=9, units='in', res=400, quality=100)
print(fplot)
invisible(dev.off())
```

The scenarios in the plot are ordered by the average probability of responding that ethics is required. 

##### Plot of estimated probabilities and 95% CIs for respondent type

```{r, out.width='80%'}
# reconstruct probabilities from chains
# use chains to calculate probability of difference in respondent type
index = grep('intercept|gamma|beta', dimnames(bugs.results$sims.array)[[3]]) 
chains1 = as.matrix(bugs.results$sims.array[1:MCMC, 1, index])
chains2 = as.matrix(bugs.results$sims.array[1:MCMC, 2, index])
chains = data.frame(rbind(chains1, chains2)) %>%
  mutate(i = 1:n(),
         p1 = exp(intercept)/(1+exp(intercept)), # HREC
         p2 = exp(intercept+gamma.1.)/(1+exp(intercept+gamma.1.)),  # Both  
         p3 = exp(intercept+gamma.2.)/(1+exp(intercept+gamma.2.)), # Researcher
         diff1 = p2 - p1, # Both minus HREC
         diff2 = p3 - p1, # Researcher minus HREC
         s1 = exp(intercept+beta.c.1.)/(1+exp(intercept+beta.c.1.)),  # version A
         s4 = exp(intercept+beta.c.4.)/(1+exp(intercept+beta.c.4.)),  # version D
         diff3 = s4 - s1) # Version 
pvalue = (sum(chains$gamma.1.<0) + 1)/ (nrow(chains) + 1)
pvalue.diff = 2*min( c(sum(chains$diff1<0) / nrow(chains), 1-(sum(chains$diff1<0) / nrow(chains)))) # two-sided difference for HREC and Both
pvalue.diff.version = 2*min( c(sum(chains$diff3<0) / nrow(chains), 1-(sum(chains$diff3<0) / nrow(chains)))) # two-sided difference for version A and D
summary = gather(chains, 'p1','p2','p3', 'diff1','diff2', key='resp', value='prob') %>%
  group_by(resp) %>%
  summarise(mean = mean(prob),
            lower = quantile(prob, 0.025),
            upper = quantile(prob, 0.975)) %>%
  mutate(resp = as.numeric(str_remove(resp,'p')))
# plot
rplot = ggplot(data=summary, aes(x=resp, y=mean, ymin=lower, ymax=upper))+
  geom_point(col='sky blue', size=5)+
  geom_errorbar(col='sky blue', width=0, lwd=1.1)+
  scale_x_continuous(breaks=1:3, labels=c('HREC','Both','Researcher'))+
  theme_bw()+
  xlab('')+
  ylab('Probability for answering that ethics is required')+
  coord_flip()
rplot
```

The plot shows the estimated probabilities for researchers and 'both' compared with HREC as the reference category. The probability that researchers have a lower mean than HRECs is 0.999.

##### Plot of estimated probabilties and 95% CIs for survey version

```{r plot.version.HRECs, out.width='80%'}
version = data.frame(res.combined[grep('p.version', rownames(res.combined)), c(1,3,7)])
names(version) = c('mean','lower','upper')
version = mutate(version, survey=factor(1:4, labels=LETTERS[1:4]))
rplot = ggplot(data=version, aes(x=survey, y=mean, ymin=lower, ymax=upper))+
  geom_point(col='sky blue', size=5)+
  geom_errorbar(col='sky blue', width=0, lwd=1.1)+
  theme_bw()+
  xlab('Survey')+
  ylab('Probability of answering that ethics is required')+
  coord_flip()
rplot
# difference statistics

```

The plot shows the estimated probabilities and 95% credible intervals. The estimates are from the Bayesian logistic regression model. These are the estimates for the effect of survey version.

The estimated probability that surveys version 4 has a higher response probability that survey version 1 is `r round(p.value.version, 4)`.

##### Random effect standard deviations

The table below shows the estimated standard deviations ('sigma') for the three random effects from the Bayesian logistic regression model. These were the random effects for: individual respondents, the four survey versions, and the scenarios. The higher the standard deviation, the more variability there was in that group. So there was a much greater variability in responses for individuals and scenarios than for survey versions, but the variation for versions was still relatively large.

```{r}
pander(tau, style='simple', digits=3)
```

### Model checking: comparison of observed and predicted probabilities

```{r model.check, fig.width=11, fig.height=7}
# observed counts
observed = group_by(for.logistic, scenarion, respondent) %>% # average over scenarios, respondent
  summarise(r = sum(answern), n=n()) %>% # calculate number of yes answers per group and denominator
  mutate(p.obs = r/n) %>% # calculate proportion answering yes
  select(-r , -n ) %>% # remove this variables
  ungroup() %>%
  mutate(respn = case_when(respondent=='HREC' ~ 1,
                           respondent=='Both' ~ 2,
                           respondent=='Researcher' ~ 3))

# merge with winbugs results for plot
for.plot = left_join(observed, gmeans, by=c('scenarion','respn')) %>%
  mutate(respn = factor(respn, levels=1:3, labels=c('HREC','Both','Researcher')),
         xaxis = ifelse(abs(xaxis - floor(xaxis) - 0.3) <0.001, xaxis - 0.3, xaxis), # remove jitter
         xaxis = ifelse(abs(xaxis - floor(xaxis) + 0.3) <0.001, xaxis + 0.3, xaxis)   )
# plot estimates and CIs effects
model.check.plot = ggplot(data=for.plot, aes(x=xaxis , y=mean, ymin=lower, ymax=upper))+
  geom_point(col='sky blue', size=5)+
  geom_errorbar(col='sky blue', width=0, lwd=1.1)+
  geom_point(aes(x=xaxis, y=p.obs), col='red', size=5, pch=1)+
  theme_bw()+
  scale_x_continuous(breaks=1:14, labels=x.labels)+
  theme(panel.grid.minor = element_blank())+
  xlab('Scenario')+
  ylab('Probability of answering that ethics is required')+
  coord_flip()+
  facet_wrap(~respn)
model.check.plot
```

The plot shows the observed probabilities for (red circle) and the estimates and 95% CIs from the Bayesian model (blue).

The estimates consistently over-estimate the probability for the scenarios with the higher mean probabilities, and this is true for both researchers and HRECs. Most of the observed probabilities are within the 95% credible intervals.

## Software version

The list below shows the version of the R software and all the packages. This is only needed for technical queries. It also helps with computational reproducibility.

```{r}
sessionInfo()
```